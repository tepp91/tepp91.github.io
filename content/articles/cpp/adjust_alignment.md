title: アライメントを考慮したサイズの取得
date: 2017-09-17 1:21
category: C++
slug: adjust-alignment

メモリの確保などでアライメントを考慮したサイズを取得したい場合などに使用します。  

## ビット演算による求め方

アライメントの値が2の累乗であれば、ビット演算による高速な方法があります。  
アルゴリズムとしては四捨五入と同じような感じです(ギリギリまで上げて落とす)   

[gist:id=310c2ac75e136b7229097816613ac57e,file=AdjustAlignment.cpp]

## std::align(C++11)

C++11からはアライメント調整のためにstd::align関数が追加されました。  
ただこちらはアロケータ等のメモリ操作を目的に作られた関数でAPIも少し分かりにくいです。  
  
アライメントサイズと要求サイズ、それにポインタとバッファサイズを渡すと
アライメント調整されたポインタを返してくれます。  
要求サイズを渡しているのは、バッファサイズからあふれるならnullptrを返すようにしているためです。  
詳しくは[リファレンス](https://cpprefjp.github.io/reference/memory/align.html)を参考にしてください。
  
使い方は以下のようになります。

[gist:id=310c2ac75e136b7229097816613ac57e,file=StdAlign.cpp]
